async function adminApi(path, opts={}){ const token = sessionStorage.getItem('tc_admin_token'); const headers = opts.headers||{}; if(token) headers['X-Admin-Token']=token; const res = await fetch(path, Object.assign({}, opts, { headers })); if(res.status===401) document.getElementById('status').textContent='Unauthorized'; return res.json().catch(()=>({ ok:false })); }
async function load(){ const data = await adminApi('/admin/api/subscribers'); const tbody=document.querySelector('#subs tbody'); tbody.innerHTML=''; if(!Array.isArray(data)) return; data.forEach(d=>{ tbody.insertAdjacentHTML('beforeend', `<tr><td>${d.email}</td><td>${d.pro? 'Yes' : 'No'}</td><td>${d.stripe_status||''}</td><td>${d.stripe_subscription_id||''}</td><td>${d.stripe_updated_ts? new Date(d.stripe_updated_ts).toLocaleString():''}</td></tr>`); }); }
document.getElementById('save-token').addEventListener('click', ()=>{ const t=document.getElementById('admin-token').value.trim(); if(!t) return; sessionStorage.setItem('tc_admin_token', t); document.getElementById('status').textContent='Token saved'; load(); });
document.getElementById('refresh').addEventListener('click', load);
if(sessionStorage.getItem('tc_admin_token')) load();